# Description: General Purpose video player based on MPlayer and mplayer2
# URL:         https://mpv.io/
# Depends on:  docutils ffmpeg libarchive libjpeg-turbo libplacebo mesa xorg-libxinerama xorg-libxpresent xorg-libxscrnsaver

# Maintainer notes on dependencies:
#   cdda=disabled: or needs libcdio-paranoia
#   dvdnav=disabled: or needs libdvdnav
#   lcms2=disabled: or needs lcms2
#   libarchive=enabled: needs libarchive (enabled)
#   manpage-build=enabled: needs docutils (enabled)

name=mpv
version=0.41.0
release=1
source=https://github.com/mpv-player/mpv/archive/v$version/mpv-v$version.tar.gz

build() {
	meson setup build $name-$version \
		--prefix=/usr \
		--sysconfdir=/usr/etc \
		--buildtype=plain \
		--wrap-mode=nodownload \
		-D b_lto=true \
		-D b_pie=true \
		-D cdda=disabled \
		-D dvdnav=disabled \
		-D lcms2=disabled \
		-D libarchive=enabled \
		-D libmpv=true \
		-D x11=enabled \
		-D tests=false \
		-D cplayer=true \
		-D manpage-build=enabled \

	ninja -C build -j ${JOBS:-1} -v
	DESTDIR=$PKG ninja -C build install

	# Remove i18n entries and TryExec=mpv from desktop file
	sed -ri -e '/\[.+\]=/d' -e '/^TryExec=mpv/d' \
		$PKG/usr/share/applications/*.desktop

	# Remove junk & fish/zsh completion
	rm -r $PKG/usr/share/doc $PKG/usr/share/metainfo \
		$PKG/usr/share/zsh $PKG/usr/share/fish
}
