# Description: General Purpose video player based on MPlayer and mplayer2
# URL:         https://mpv.io/
# Depends on:  docutils ffmpeg libarchive libjpeg-turbo libplacebo mesa xorg-libxinerama xorg-libxpresent xorg-libxscrnsaver

name=mpv
version=0.39.0
release=1
source=https://github.com/mpv-player/mpv/archive/v$version/mpv-v$version.tar.gz

build() {
	# cdda=disabled:         otherwise, requires libcdio-paranoia
	# dvdnav=disabled:       otherwise, requires libdvdnav
	# lcms2=disabled:        otherwise, requires lcms2
	# libarchive=enabled:    requires libarchive
	# manpage-build=enabled: requires docutils
	meson setup build $name-$version  \
		--prefix=/usr             \
		--sysconfdir=/usr/etc     \
		--buildtype=plain         \
		--wrap-mode=nodownload    \
		-D b_lto=true             \
		-D b_pie=true             \
		-D cdda=disabled          \
		-D dvdnav=disabled        \
		-D lcms2=disabled         \
		-D libarchive=enabled     \
		-D libmpv=true            \
		-D x11=enabled            \
		-D tests=false            \
		-D cplayer=true           \
		-D manpage-build=enabled  \

	ninja -C build -j ${JOBS:-1} -v
	DESTDIR=$PKG ninja -C build install

	# remove i18n entries and TryExec=mpv from desktop file
	sed -ri -e '/\[.+\]=/d' -e '/^TryExec=mpv/d' \
		$PKG/usr/share/applications/*.desktop

	# remove junk & zsh completion
	rm -r $PKG/usr/share/doc/ $PKG/usr/share/zsh
}
