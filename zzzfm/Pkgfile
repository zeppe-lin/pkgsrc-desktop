# Description: Multi-panel tabbed file manager
# URL:         https://gitlab.com/skidoo/zzzfm
# Depends on:  desktop-file-utils ffmpegthumbnailer gtk ktsuss

# Maintainer notes on dependencies:
#   desktop-file-utils: Needed for post-install scripts (enabled)
#   ffmpegthumbnailer: Video thumbnails support (enabled)
#   gtk3: GTK3 GUI support (disabled by default)
#   ktsuss: Needed to run with elevated privileges (enabled)

name=zzzfm
version=1.0.7.5-c7e340f
_commit=c7e340fdeafc64229d5a6113ffbb27dad03efaa7
release=4
source="$name-$version.tar.gz::https://gitlab.com/skidoo/zzzfm/-/archive/$_commit/zzzfm-$_commit.tar.gz
	fix-crash-on-umount.patch
	gksu-ktsuss.patch"

build() {
	patch -d $name-$_commit -Np1 -i $SRC/fix-crash-on-umount.patch
	# switch from default gksu to ktsuss
	patch -d $name-$_commit -Np1 -i $SRC/gksu-ktsuss.patch

	# Optional feature flags
	if ! pkgman isinst ffmpegthumbnailer >/dev/null 2>&1; then
		PKGMK_ZZZFM="$PKGMK_ZZZFM --disable-video-thumbnails"
	fi

	export LINGUAS=' '
	export CONFIG_SHELL=/bin/bash
	export CFLAGS="$CFLAGS -Wno-incompatible-pointer-types" # gcc14 fix

	mkdir build; cd build

	NOCONFIGURE=1 ../$name-$_commit/autogen.sh
	../$name-$_commit/configure \
		--prefix=/usr \
		--disable-nls \
		$PKGMK_ZZZFM \
		#--with-gtk3

	make V=1
	make DESTDIR=$PKG install

	# Cleanup
	rm -r $PKG/usr/share/doc
}
