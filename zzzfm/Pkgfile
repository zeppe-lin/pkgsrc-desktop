# Description: Multi-panel tabbed file manager
# URL:         https://gitlab.com/skidoo/zzzfm
# Depends on:  desktop-file-utils ffmpegthumbnailer gtk3 ktsuss
# Optional:    ktsuss

name=zzzfm
version=1.0.7.5-c7e340f
_commit=c7e340fdeafc64229d5a6113ffbb27dad03efaa7
release=3
source="$name-$version.tar.gz::https://gitlab.com/skidoo/zzzfm/-/archive/$_commit/zzzfm-$_commit.tar.gz
	fix-crash-on-umount.patch
	gksu-ktsuss.patch"

build() {
	patch -d $name-$_commit -Np1 -i $SRC/fix-crash-on-umount.patch
	# switch from default gksu to ktsuss
	patch -d $name-$_commit -Np1 -i $SRC/gksu-ktsuss.patch

	if ! pkgman isinst ffmpegthumbnailer; then
		PKGMK_ZZZFM="$PKGMK_ZZZFM --disable-video-thumbnails"
	fi

	export LINGUAS=' '
	export CONFIG_SHELL=/bin/bash
	export CFLAGS="$CFLAGS -Wno-incompatible-pointer-types" # gcc14 fix

	mkdir build; cd build

	NOCONFIGURE=1 ../$name-$_commit/autogen.sh
	../$name-$_commit/configure  \
		--prefix=/usr        \
		--disable-nls        \
		--with-gtk3          \
		$PKGMK_ZZZFM         \

	make V=1
	make DESTDIR=$PKG install

	# remove junk
	rm -r $PKG/usr/share/doc
}
