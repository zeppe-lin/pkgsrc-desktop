# Description: Toolkit for XML Digital Signature and Encryption
# URL:         https://www.aleksey.com/xmlsec/index.html
# Depends on:  gnutls libtool libxslt nss openssl

name=xmlsec
version=1.3.9
release=1
_tag_version=$(printf '%s\n' "$version" | tr . _)
source="https://github.com/lsh123/$name/archive/refs/tags/xmlsec_$_tag_version.tar.gz
	xmlsec-1.3.0-optimisation.patch"

build() {
	cd xmlsec-xmlsec_$_tag_version

	patch -Np1 -i $SRC/xmlsec-1.3.0-optimisation.patch

	# Test failure (silent) with dash as /bin/sh.
	# https://bugs.gentoo.org/721128
	CONFIG_SHELL=/bin/bash \
	./autogen.sh \
		--prefix=/usr \
		--disable-static-linking \
		--disable-docs \

	# Ensure --as-needed is applied to shared linker invocations
	sed -i 's/ -shared / -Wl,-O1,--as-needed\0/g' libtool

	make V=1
	make DESTDIR=$PKG install

	# Remove libtool archives
	rm $PKG/usr/lib/*.la
}
