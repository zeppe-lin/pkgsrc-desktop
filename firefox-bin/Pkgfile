# Description: Standalone web browser from mozilla.org
# URL:         https://www.mozilla.org/en-US/firefox/
# Depends on:  alsa-lib dbus-glib desktop-file-utils gtk3 nss xorg-libxtst hicolor-icon-theme
# Optional:    desktop-file-utils

name=firefox-bin
version=138.0.4
release=1
source="https://ftp.mozilla.org/pub/firefox/releases/$version/linux-x86_64/en-US/firefox-$version.tar.xz
	firefox.sh
	firefox.1
	firefox.desktop
	policies.json"

build() {
	mkdir -p $PKG/opt $PKG/usr/bin

	mv $SRC/firefox $PKG/opt/firefox
	install -m 0755 -D firefox.sh                    $PKG/usr/bin/firefox
	install -m 0644 -Dt $PKG/usr/share/man/man1      $SRC/firefox.1
	install -m 0644 -Dt $PKG/usr/share/applications  $SRC/firefox.desktop

	for x in 16 32 48 64 128; do
		mkdir -p $PKG/usr/share/icons/hicolor/${x}x${x}/apps
		ln -sv /opt/firefox/browser/chrome/icons/default/default$x.png \
			$PKG/usr/share/icons/hicolor/${x}x${x}/apps/firefox.png
	done

	# Disable automatic updates using policies
	install -m 0644 -Dt $PKG/opt/firefox/distribution policies.json

	# Configure revdep(1) additional directories
	mkdir -p $PKG/etc/revdep.d
	echo "/opt/firefox" > $PKG/etc/revdep.d/$name
}
