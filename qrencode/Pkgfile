# Description: C library for encoding data in a QR Code symbol
# URL:         https://github.com/fukuchi/libqrencode
# Depends:     libpng scdoc

name=qrencode
version=4.1.1
release=3
source="https://github.com/fukuchi/libqrencode/archive/v$version/$name-$version.tar.gz
	qrencode.1.scdoc"

build() {
	cmake -S libqrencode-$version -B build -G Ninja \
		-D CMAKE_INSTALL_PREFIX=/usr \
		-D CMAKE_INSTALL_LIBDIR=lib \
		-D CMAKE_BUILD_TYPE=Release \
		-D CMAKE_C_FLAGS_RELEASE="$CFLAGS" \
		-D BUILD_SHARED_LIBS=ON \
		-Wno-dev

	ninja -C build -j ${JOBS:-1} -v
	DESTDIR=$PKG ninja -C build install

	# install custom man page (upstream version is ugly as f*ck)
	scdoc < $SRC/qrencode.1.scdoc > $PKG/usr/share/man/man1/qrencode.1
}
