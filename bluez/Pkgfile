# Description: Bluetooth libraries and utilities
# URL:         http://www.bluez.org/
# Depends on:  alsa-lib dbus json-c libical

# Maintainer notes on dependencies:
#   --disable-cups: CUPS printer support, needs cups (disabled)
#   --disable-manpages: Build man pages, needs docutils+pygments (disabled)
#   --enable-obex: OBEX profile support, needs libical (enabled)
#   --enable-mesh: Mesh profile support, needs json-c (enabled)
#   --enable-midi: MIDI support, needs alsa-lib (enabled)

name=bluez
version=5.85
release=1
source="https://mirrors.edge.kernel.org/pub/linux/bluetooth/bluez-$version.tar.xz
	rc.bluetoothd
	modprobe.btusb.conf"

build() {
	mkdir build; cd build

	../bluez-$version/configure \
		--prefix=/usr \
		--sysconfdir=/etc \
		--localstatedir=/var \
		--libexecdir=/usr/lib \
		--disable-cups \
		--disable-manpages \
		--disable-systemd \
		--enable-a2dp \
		--enable-experimental \
		--enable-library \
		--enable-midi \
		--enable-obex \
		--enable-tools \

	make V=1
	make DESTDIR=$PKG install

	# Configuration file
	install -m 0644 -D ../bluez-$version/src/main.conf \
		$PKG/etc/bluetooth/main.conf

	# Service script
	install -m 0755 -D $SRC/rc.bluetoothd \
		$PKG/etc/rc.d/bluetoothd

	# Modprobe configuration
	install -m 0644 -D $SRC/modprobe.btusb.conf \
		$PKG/lib/modprobe.d/btusb.conf

	# libical-related utility
	install -m 0755 -Dt $PKG/usr/lib/bluetooth tools/obexctl

	# Remove zsh completion
	rm -r $PKG/usr/share/zsh
}
