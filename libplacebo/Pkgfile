# Description: GPU-accelerated primitives for video and image rendering
# URL:         https://github.com/haasn/libplacebo
# Depends on:  glslang libunwind py3-glad vulkan-loader
# Optional:    vulkan-loader libunwind shaderc lcms2

name=libplacebo
version=7.351.0
release=2
source="https://github.com/haasn/$name/archive/v$version/$name-$version.tar.gz
	libplacebo-7.349.0-glslang-1.3.296.patch
	no-vulkan-headers.patch"

build() {
	for p in libplacebo*.patch no-vulkan-headers.patch; do
		patch -d $name-$version -Np1 -i $SRC/${p}
	done

	meson setup build $name-$version  \
		--prefix=/usr             \
		--buildtype=plain         \
		--wrap-mode=nodownload    \
		-D b_lto=true             \
		-D b_pie=true             \
		-D d3d11=disabled         \
		-D demos=false            \
		-D glslang=enabled        \
		-D lcms=disabled          \
		-D shaderc=disabled       \
		-D tests=false            \
		-D vulkan=enabled         \
		-D vulkan-registry=/usr/share/vulkan/registry/vk.xml

	ninja -C build -j ${JOBS:-1} -v
	DESTDIR=$PKG ninja -C build install
}
